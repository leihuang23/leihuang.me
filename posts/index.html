<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Posts | Lei&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="Posts - Lei&#39;s Blog">
<meta name="author" content="Lei Huang">
<link rel="canonical" href="https://leihuang.me/posts/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5e7b8467ca60c328c5f65edb09c1fe0c15b5a1394c72e8cf0bd4a4fd82d9d3f2.css" integrity="sha256-XnuEZ8pgwyjF9l7bCcH&#43;DBW1oTlMcujPC9Sk/YLZ0/I=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://leihuang.me/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://leihuang.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://leihuang.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://leihuang.me/apple-touch-icon.png">
<link rel="mask-icon" href="https://leihuang.me/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://leihuang.me/posts/index.xml">
<link rel="alternate" hreflang="en" href="https://leihuang.me/posts/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://leihuang.me/posts/">
  <meta property="og:site_name" content="Lei&#39;s Blog">
  <meta property="og:title" content="Posts">
  <meta property="og:description" content="Lei Huang - Personal Blog of Lei Huang">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Posts">
<meta name="twitter:description" content="Lei Huang - Personal Blog of Lei Huang">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://leihuang.me/posts/"
    }
  ]
}
</script>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://leihuang.me/" accesskey="h" title="Lei&#39;s Blog (Alt + H)">Lei&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://leihuang.me/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://leihuang.me/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://leihuang.me/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://leihuang.me/">Home</a></div>
  <h1>
    Posts
    <a href="/posts/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Learn Batching From LLM
    </h2>
  </header>
  <div class="entry-content">
    <p>Note: I was reviewing my old notebook and came across a piece of code that I took from somewhere many years ago. I asked Claude 3.7 Sonnet about this code. And here’s the conversation:
Lei Take a look at the following code:
let timeout = null; const queue = new Set(); function process() { for (const task of queue) { task(); } queue.clear(); timeout = null; } function enqueue(task) { if (timeout === null) timeout = setTimeout(process, 0); queue.add(task); } I’m not sure how is this code useful. One scenario I can think of is modifying the DOM. Doing DOM manipulation in one batch might avoid reflow. But I’m fuzzy on details. Can you give me a concrete example?
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-03-30 15:11:05 +0200 CEST'>March 30, 2025</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Lei Huang</footer>
  <a class="entry-link" aria-label="post link to Learn Batching From LLM" href="https://leihuang.me/posts/learn-batching-from-llm/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Category Mapping with Embedding
    </h2>
  </header>
  <div class="entry-content">
    <p>Recently, I faced a daunting task: migrating all of our existing product deals to a brand new, more comprehensive, and standardized set of canonical product categories. This was critical for improving product discoverability, ensuring consistent marketing, and enabling better reporting. Think of it as moving from a somewhat disorganized, ad-hoc filing system to a meticulously organized, hierarchical library catalog.
The problem? Our system had tens of thousands of deals, each with existing category assignments that were often inconsistent, incomplete, or simply didn’t map cleanly to the new structure. Manually re-categorizing everything was out of the question. It would have taken an absurd amount of time and been incredibly prone to errors. I needed an automated solution, but a simple keyword-based approach wouldn’t work. The nuances of product descriptions and the potential mismatches between the old and new categories demanded something far more intelligent.
...</p>
  </div>
  <footer class="entry-footer"><span title='2023-07-01 00:00:00 +0000 UTC'>July 1, 2023</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Lei Huang</footer>
  <a class="entry-link" aria-label="post link to Category Mapping with Embedding" href="https://leihuang.me/posts/category-mapping-with-embedding/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Time-slicing With Coroutine
    </h2>
  </header>
  <div class="entry-content">
    <p>I wrote about time-slicing with CPS technique in the last blog post. The solution I proposed has two drawbacks:
The control over task scheduling is too weak. Task slicing relies entirely on hacking the JavaScript engine’s event loop, and it’s impossible to arbitrarily pause and resume. This makes it impossible to precisely time the slices; you can only set them based on subjective experience (the example I provided uses 500 as the interval). However, 500 tasks might still be too long, causing the main thread to be blocked for too long. Or it might be too short, not fully utilizing the current call stack. setTimeout’s timing is inaccurate, and the actual time interval will have deviations. The result is that the delays of each task accumulate, significantly increasing the total task completion time. An alternative solution: Coroutine If a computational task can suspend itself and yield execution to other tasks, it’s a coroutine.
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-08-15 00:00:00 +0000 UTC'>August 15, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Lei Huang</footer>
  <a class="entry-link" aria-label="post link to Time-slicing With Coroutine" href="https://leihuang.me/posts/time-slicing-with-coroutine/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Time-slicing With Continuation-passing Style
    </h2>
  </header>
  <div class="entry-content">
    <p>Background story In January this year, I applied for an overseas dev job. I was asked to finish a project as homework. The project required a ton of computations on the front end, which posed a challenge as I must ensure no operations should block the main thread. I didn’t want to move the computation to a worker thread because the data was consumed in the main thread. Serializing and de-serializing a large set of data also has a performance cost. Furthermore, to improve indexing performance, I used Map to store the results, which is not serializable.
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-08-06 00:00:00 +0000 UTC'>August 6, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Lei Huang</footer>
  <a class="entry-link" aria-label="post link to Time-slicing With Continuation-passing Style" href="https://leihuang.me/posts/time-slicing-with-cps/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Typewriter Effect With RxJS
    </h2>
  </header>
  <div class="entry-content">
    <p>Background I recently rewrote my blog website from scratch in Gatsby. This time, I didn’t use a starter template, so I had to make a lot of design decisions. When I wrote the bio section on the home page, initially I put a long heading there as a one-sentence introduction. As I was gazing at the screen, I felt something was wrong. It was too wordy. But after I took out a few words, I was not satisfied with what was left.
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-03-30 00:00:00 +0000 UTC'>March 30, 2020</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Lei Huang</footer>
  <a class="entry-link" aria-label="post link to Typewriter Effect With RxJS" href="https://leihuang.me/posts/typewritter-in-rxjs/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Implementing A Trie In JavaScript
    </h2>
  </header>
  <div class="entry-content">
    <p>Recently, I encountered a situation where I need to perform text searches in a large set of data. Normally, I would do it in a filter function, but that would be slow when the list is too long. There’s a data structure for this situation. Meet the Trie!
Trie (pronounced try) is a tree-like data structure that’s created for efficient text searches.
How does it work Trie takes all words and rearranges them in a tree hierarchy. For example, the list of words [&#39;abet&#39;, &#39;abode&#39;, &#39;abort&#39;] will be transformed into a structure like this:
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-01-04 00:00:00 +0000 UTC'>January 4, 2020</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Lei Huang</footer>
  <a class="entry-link" aria-label="post link to Implementing A Trie In JavaScript" href="https://leihuang.me/posts/implementing-tri/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Introduction to Lenses in JavaScript
    </h2>
  </header>
  <div class="entry-content">
    <p>When I was reading Eric Elliott&#39;s article on Lenses , I was curious about how such beautiful magic can be fully implemented in JavaScript. It was a tough exploration. Many of the tutorials online are about Haskell, which cannot be easily translated to JavaScript. I read the source code of Ramda and finally grokked how it works.
...</p>
  </div>
  <footer class="entry-footer"><span title='2019-01-17 00:00:00 +0000 UTC'>January 17, 2019</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Lei Huang</footer>
  <a class="entry-link" aria-label="post link to Introduction to Lenses in JavaScript" href="https://leihuang.me/posts/lens-in-js/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Parabolic Curve Animation With RxJS
    </h2>
  </header>
  <div class="entry-content">
    <p>I came across this article (written in Chinese) the other day. It was about parabolic curve animation in vanilla JS. I wondered how RxJS can implement this. Below is the result of my investigation.
Imagine we take a perspective from a slow-motion camera. What humans see as a smooth animation is just an object that is put at different places at every fragment of a time period. This can be expressed as a ‘stream’ of object position. The mechanism of an animation can be simplified by somehow mapping every fragment of a time period to a position point in space. In practice, time cannot be fragmented indefinitely, what we want is an approximation of an “atomic time unit”. The browser has provided us a tool to achieve this, which is the requestAnimationFrame API.
...</p>
  </div>
  <footer class="entry-footer"><span title='2018-08-02 00:00:00 +0000 UTC'>August 2, 2018</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Lei Huang</footer>
  <a class="entry-link" aria-label="post link to Parabolic Curve Animation With RxJS" href="https://leihuang.me/posts/curve-animation-in-js/"></a>
</article>
    </main>
    
<footer class="footer">
        <span>© 2025 Lei Huang</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
