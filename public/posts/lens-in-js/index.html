<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Introduction to Lenses in JavaScript | Lei Huang</title>
<meta name="keywords" content="fp, lens">
<meta name="description" content="This article aims to teach you how to implement lenses in vanilla JavaScript. You&#39;ll appreciate the expressiveness of functional programming.">
<meta name="author" content="Lei Huang">
<link rel="canonical" href="https://leihuang.me/posts/lens-in-js/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css" integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF&#43;13Dyqob6ASlTrTye8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://leihuang.me/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://leihuang.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://leihuang.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://leihuang.me/apple-touch-icon.png">
<link rel="mask-icon" href="https://leihuang.me/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://leihuang.me/posts/lens-in-js/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://leihuang.me/posts/lens-in-js/">
  <meta property="og:site_name" content="Lei Huang">
  <meta property="og:title" content="Introduction to Lenses in JavaScript">
  <meta property="og:description" content="This article aims to teach you how to implement lenses in vanilla JavaScript. You&#39;ll appreciate the expressiveness of functional programming.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-01-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2019-01-17T00:00:00+00:00">
    <meta property="article:tag" content="Fp">
    <meta property="article:tag" content="Lens">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Introduction to Lenses in JavaScript">
<meta name="twitter:description" content="This article aims to teach you how to implement lenses in vanilla JavaScript. You&#39;ll appreciate the expressiveness of functional programming.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://leihuang.me/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Introduction to Lenses in JavaScript",
      "item": "https://leihuang.me/posts/lens-in-js/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Introduction to Lenses in JavaScript",
  "name": "Introduction to Lenses in JavaScript",
  "description": "This article aims to teach you how to implement lenses in vanilla JavaScript. You'll appreciate the expressiveness of functional programming.",
  "keywords": [
    "fp", "lens"
  ],
  "articleBody": "When I was reading Eric Elliottâ€™s article on Lenses, I was curious about how such beautiful magic can be fully implemented in JavaScript. It was a tough exploration. Many of the tutorials online are about Haskell, which cannot be easily translated to JavaScript. I read the source code of Ramda and finally grokked how it works.\nIn order to understand lenses, you need to first understand some prerequisite functional programming concepts. Iâ€™ll walk you through the essential ones.\nCurrying Currying is a technique that you use to delay function execution. It enables you to feed a function one argument at a time. For example, with function const add = (x, y) =\u003e x + y, you need to feed the function two numbers at once in order to perform the calculation. What if we only have the first argument value available and want to store it in the add function context, and later call it when weâ€™re ready? Like this:\nconst add = (x, y) =\u003e x + y // we get a value v from somewhere, and we want to store it in the add function context const addV = add(v) // and later we get a value w, we can finally perform the addition addV(w) The example is trivial, but you get the idea. Why do we want to store a value inside the context of a function? This is how we combine value with behaviors in functional programming. Youâ€™ll see what I mean once we get to the lens part.\nHereâ€™s how we implement currying in JavaScript:\nconst curry = fn =\u003e (...args) =\u003e args.length \u003e= fn.length ? fn(...args) : curry(fn.bind(undefined, ...args)) Functors Functors are just data types that you can map over. Think about JavaScript array, you can map over an array and transform the values inside of it. Functors are similar, they are â€˜boxesâ€™ that hold computational context. Letâ€™s see a few examples:\nconst Box = x =\u003e ({ value: x, map: f =\u003e Box(f(x)) }) Box is a functor. We canâ€™t see what use it has yet. But letâ€™s observe some properties of it.\nWhen you call Box with a value, the value is stored in a context, which is the returned object. After that, you can transform the value by mapping over the context however you want.\nBox(2) .map(x =\u003e x + 1) .map(x =\u003e x * 2) We are stacking up computations by mapping. Thatâ€™s all we need to know about functors for now.\nImplementing lenses Letâ€™s put what we just learned into use and implement lenses!\nFirst, we define functional getters and setters. Theyâ€™re pretty simple.\nconst prop = curry((k, obj) =\u003e (obj ? obj[k] : undefined)); const assoc = curry((k, v, obj) =\u003e ({ ...obj, [k]: v })); const obj = {a: 1, b: 2}; prop(â€˜aâ€™)(obj) // 1 assoc(a)(3)(obj) // {a: 3, b: 2} Then we define a function to make lenses:\nconst makLens = curry( (getter, setter) =\u003e functor =\u003e target =\u003e functor(getter(target)).map(focus =\u003e setter(focus, target)) ) I know how you feel about this cryptic function. Just ignore it, for now. Weâ€™ll come back to it when weâ€™re ready.\nLetâ€™s simplify the makeLens function a bit and make the getter and setter ready:\nconst lensProp = k =\u003e makeLens(prop(k), assoc(k)) Here come the mighty functors:\nconst getFunctor = x =\u003e Object.freeze({ value: x, map: f =\u003e getFunctor(x) }) const setFunctor = x =\u003e Object.freeze({ value: x, map: f =\u003e setFunctor(f(x)) }) You can see they are very similar as the Box functor weâ€™ve defined earlier. We use Object.freeze() to prevent mutations, as mutations in functional programming are forbidden.The getFunctor just ignores the mapping function and always returns the initial value, seems like very silly.\nNow, weâ€™re finally ready to make something useful!\nconst view = curry((lens, obj) =\u003e lens(getFunctor)(obj).value) const sample = {foo: {bar: {ha: 6}}} const lensFoo = lensProp('foo') view(lensFoo, sample) // =\u003e {bar: {ha: 6}} Yay! After so much cryptic code, we are finally able to get a value out from an object! ðŸ¤£\nBefore we continue, letâ€™s reason about the above code.\nWhen we call lens with getFunctor, and later call getFunctor with a value pulled out by the getter function provided earlier, we get a very simple computational context. In the case of getFunctor, this context just provides the initial value and ignores mapping operations later.\nLetâ€™s look at set operations:\nconst over = curry((lens, f, obj) =\u003e lens(y =\u003e setFunctor(f(y)))(obj).value) const always = a =\u003e b =\u003e a const set = curry((lens, val, obj) =\u003e over(lens, always(val), sample)) set(lensFoo, 5, sample) // =\u003e {foo: 5} This time, the setFunctor doesnâ€™t ignore mapping operations, so the operation map(focus =\u003e setter(focus, target)) from the makeLens function will be performed, giving us the opportunity to transform the value returned by the getter function.\nThe always function looks silly, but look at how we use it to implement set, itâ€™s a useful one!\nThe power of lenses Based on the examples I gave earlier, itâ€™s not obvious how useful lenses can be. In JavaScript, we can read and set values in objects very easily. It seems like thereâ€™s no need for all the hassles!\nThe power of lenses comes from their composability.\nLetâ€™s first define a compose function:\nconst compose = (...fns) =\u003e args =\u003e fns.reduceRight((x, f) =\u003e f(x), args) Then we can read the inner values of the sample object like this:\nconst lensFoo = lensProp('foo') const lensBar = lensProp('bar') const lensFooBar = compose(lensFoo, lensBar) view(lensFooBar, sample) // =\u003e {ha: 6} We can write a helper function to help us to get the inner lens:\nconst lensPath = path =\u003e compose(...path.map(lensProp)) const lensHa = lensPath(['foo', 'bar', 'ha']) const add = a =\u003e b =\u003e a + b view(lensHa, sample) // =\u003e 6 over(lensHa, add(2), sample) // =\u003e {foo: {bar: {ha: 8}}} Ok, I know you must be thinking: howâ€™s this powerful? I can achieve the same thing using lodash _.get()! Stay patient!\nLetâ€™s consider another example. Say we have an app that lets users log their body weight. Users can fill in with both killograms and pounds. To avoid data redundancy, we only stores user records in killograms. Hereâ€™s a user record:\nconst user = {weightInKg: 65} We know that we have the following conversion rate between kg and lb:\nconst kgToLb = kg =\u003e 2.20462262 * kg const lbToKg = lb =\u003e 0.45359237 * lb If we want to display the userâ€™s weight in pounds, we can get the weight in kg, and convert it to lb, which is a very straightforward approach. But we can do it more smoothly with lenses:\nconst weightInKg = lensProp('weightInKg') const lensLb = lens(kgToLb, lbToKg) const inLb = compose(lensLb, weightInKg) view(inLb, user) // -\u003e 143.3 This looks neat. We provide different lenses to the view function, it will return us a tailored result, and the target data remains untouched.\nSuppose that the user one day adds 5 pounds to his record, the data can be updated easily like this:\nover(inLb, add(5), user) // -\u003e 67.27 Wow! That reads like plain English. Without digging into the implementation details, we can interpret the operation as this: under this lens, I want to add 5 to the user record. I donâ€™t care in what unit the stored data may be, just do it for me! The power of declarative programming really shines in this example.\n",
  "wordCount" : "1222",
  "inLanguage": "en",
  "datePublished": "2019-01-17T00:00:00Z",
  "dateModified": "2019-01-17T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Lei Huang"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://leihuang.me/posts/lens-in-js/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Lei Huang",
    "logo": {
      "@type": "ImageObject",
      "url": "https://leihuang.me/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://leihuang.me/" accesskey="h" title="Lei Huang (Alt + H)">Lei Huang</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://leihuang.me/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://leihuang.me/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://leihuang.me/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://leihuang.me/">Home</a>&nbsp;Â»&nbsp;<a href="https://leihuang.me/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Introduction to Lenses in JavaScript
    </h1>
    <div class="post-description">
      This article aims to teach you how to implement lenses in vanilla JavaScript. You&#39;ll appreciate the expressiveness of functional programming.
    </div>
    <div class="post-meta"><span title='2019-01-17 00:00:00 +0000 UTC'>January 17, 2019</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;Lei Huang

</div>
  </header> 
  <div class="post-content"><p>When I was reading <a href="https://medium.com/javascript-scene/lenses-b85976cb0534">Eric Elliott&rsquo;s article on Lenses</a>,
I was curious about how such beautiful magic can be fully implemented in
JavaScript. It was a tough exploration. Many of the tutorials online are about
Haskell, which cannot be easily translated to JavaScript. I read the source code
of Ramda and finally grokked how it works.</p>
<p>In order to understand lenses, you need to first understand some prerequisite
functional programming concepts. Iâ€™ll walk you through the essential ones.</p>
<h2 id="currying">Currying<a hidden class="anchor" aria-hidden="true" href="#currying">#</a></h2>
<p>Currying is a technique that you use to delay function execution. It enables you
to feed a function one argument at a time. For example, with function
<code>const add = (x, y) =&gt; x + y</code>, you need to feed the function two numbers at once
in order to perform the calculation. What if we only have the first argument
value available and want to store it in the <code>add</code> function context, and later
call it when weâ€™re ready? Like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">add</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// we get a value v from somewhere, and we want to store it in the add function context
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">addV</span> <span class="o">=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// and later we get a value w, we can finally perform the addition
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">addV</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
</span></span></code></pre></div><p>The example is trivial, but you get the idea. Why do we want to store a value
inside the context of a function? This is how we combine value with behaviors in
functional programming. Youâ€™ll see what I mean once we get to the lens part.</p>
<p>Hereâ€™s how we implement currying in JavaScript:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">curry</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fn</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">fn</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="o">:</span> <span class="nx">curry</span><span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">))</span>
</span></span></code></pre></div><h2 id="functors">Functors<a hidden class="anchor" aria-hidden="true" href="#functors">#</a></h2>
<p>Functors are just data types that you can map over. Think about JavaScript
array, you can map over an array and transform the values inside of it. Functors
are similar, they are â€˜boxesâ€™ that hold computational context. Letâ€™s see a few
examples:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Box</span> <span class="o">=</span> <span class="nx">x</span> <span class="p">=&gt;</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">value</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">map</span><span class="o">:</span> <span class="nx">f</span> <span class="p">=&gt;</span> <span class="nx">Box</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>Box</code> is a functor. We canâ€™t see what use it has yet. But letâ€™s observe some
properties of it.</p>
<p>When you call <code>Box</code> with a value, the value is stored in a context, which is the
returned object. After that, you can transform the value by mapping over the
context however you want.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">Box</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="p">=&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="p">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span></span></code></pre></div><p>We are stacking up computations by mapping. Thatâ€™s all we need to know about functors for now.</p>
<h2 id="implementing-lenses">Implementing lenses<a hidden class="anchor" aria-hidden="true" href="#implementing-lenses">#</a></h2>
<p>Letâ€™s put what we just learned into use and implement lenses!</p>
<p>First, we define functional getters and setters. Theyâ€™re pretty simple.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">((</span><span class="nx">k</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">?</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">assoc</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">((</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">obj</span><span class="p">,</span> <span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="o">:</span> <span class="nx">v</span> <span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">prop</span><span class="p">(</span><span class="err">â€˜</span><span class="nx">a</span><span class="err">â€™</span><span class="p">)(</span><span class="nx">obj</span><span class="p">)</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">assoc</span><span class="p">(</span><span class="nx">a</span><span class="p">)(</span><span class="mi">3</span><span class="p">)(</span><span class="nx">obj</span><span class="p">)</span> <span class="c1">// {a: 3, b: 2}
</span></span></span></code></pre></div><p>Then we define a function to make lenses:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">makLens</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">getter</span><span class="p">,</span> <span class="nx">setter</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">functor</span> <span class="p">=&gt;</span> <span class="nx">target</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">functor</span><span class="p">(</span><span class="nx">getter</span><span class="p">(</span><span class="nx">target</span><span class="p">)).</span><span class="nx">map</span><span class="p">(</span><span class="nx">focus</span> <span class="p">=&gt;</span> <span class="nx">setter</span><span class="p">(</span><span class="nx">focus</span><span class="p">,</span> <span class="nx">target</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>I know how you feel about this cryptic function. Just ignore it, for now. Weâ€™ll
come back to it when weâ€™re ready.</p>
<p>Letâ€™s simplify the <code>makeLens</code> function a bit and make the getter and setter
ready:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lensProp</span> <span class="o">=</span> <span class="nx">k</span> <span class="p">=&gt;</span> <span class="nx">makeLens</span><span class="p">(</span><span class="nx">prop</span><span class="p">(</span><span class="nx">k</span><span class="p">),</span> <span class="nx">assoc</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span>
</span></span></code></pre></div><p>Here come the mighty functors:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">getFunctor</span> <span class="o">=</span> <span class="nx">x</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">map</span><span class="o">:</span> <span class="nx">f</span> <span class="p">=&gt;</span> <span class="nx">getFunctor</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">setFunctor</span> <span class="o">=</span> <span class="nx">x</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">map</span><span class="o">:</span> <span class="nx">f</span> <span class="p">=&gt;</span> <span class="nx">setFunctor</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span></code></pre></div><p>You can see they are very similar as the <code>Box</code> functor weâ€™ve defined earlier. We
use <code>Object.freeze()</code> to prevent mutations, as mutations in functional
programming are forbidden.The <code>getFunctor</code> just ignores the mapping function and
always returns the initial value, seems like very silly.</p>
<p>Now, weâ€™re finally ready to make something useful!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">((</span><span class="nx">lens</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">lens</span><span class="p">(</span><span class="nx">getFunctor</span><span class="p">)(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">sample</span> <span class="o">=</span> <span class="p">{</span><span class="nx">foo</span><span class="o">:</span> <span class="p">{</span><span class="nx">bar</span><span class="o">:</span> <span class="p">{</span><span class="nx">ha</span><span class="o">:</span> <span class="mi">6</span><span class="p">}}}</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lensFoo</span> <span class="o">=</span> <span class="nx">lensProp</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">view</span><span class="p">(</span><span class="nx">lensFoo</span><span class="p">,</span> <span class="nx">sample</span><span class="p">)</span> <span class="c1">// =&gt; {bar: {ha: 6}}
</span></span></span></code></pre></div><p>Yay! After so much cryptic code, we are finally able to get a value out from an
object! ðŸ¤£</p>
<p>Before we continue, letâ€™s reason about the above code.</p>
<p>When we call lens with <code>getFunctor</code>, and later call <code>getFunctor</code> with a value
pulled out by the getter function provided earlier, we get a very simple
computational context. In the case of <code>getFunctor</code>, this context just provides
the initial value and ignores mapping operations later.</p>
<p>Letâ€™s look at set operations:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">over</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">((</span><span class="nx">lens</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">lens</span><span class="p">(</span><span class="nx">y</span> <span class="p">=&gt;</span> <span class="nx">setFunctor</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">y</span><span class="p">)))(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">always</span> <span class="o">=</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">b</span> <span class="p">=&gt;</span> <span class="nx">a</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">set</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">((</span><span class="nx">lens</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">over</span><span class="p">(</span><span class="nx">lens</span><span class="p">,</span> <span class="nx">always</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span> <span class="nx">sample</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nx">set</span><span class="p">(</span><span class="nx">lensFoo</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">sample</span><span class="p">)</span> <span class="c1">// =&gt; {foo: 5}
</span></span></span></code></pre></div><p>This time, the <code>setFunctor</code> doesnâ€™t ignore mapping operations, so the operation
<code>map(focus =&gt; setter(focus, target))</code> from the <code>makeLens</code> function will be
performed, giving us the opportunity to transform the value returned by the
getter function.</p>
<p>The <code>always</code> function looks silly, but look at how we use it to implement <code>set</code>,
itâ€™s a useful one!</p>
<h2 id="the-power-of-lenses">The power of lenses<a hidden class="anchor" aria-hidden="true" href="#the-power-of-lenses">#</a></h2>
<p>Based on the examples I gave earlier, itâ€™s not obvious how useful lenses can be.
In JavaScript, we can read and set values in objects very easily. It seems like
thereâ€™s no need for all the hassles!</p>
<p><strong>The power of lenses comes from their composability.</strong></p>
<p>Letâ€™s first define a <code>compose</code> function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">compose</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="p">(...</span><span class="nx">fns</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">args</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fns</span><span class="p">.</span><span class="nx">reduceRight</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="nx">args</span><span class="p">)</span>
</span></span></code></pre></div><p>Then we can read the inner values of the <code>sample</code> object like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lensFoo</span> <span class="o">=</span> <span class="nx">lensProp</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lensBar</span> <span class="o">=</span> <span class="nx">lensProp</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lensFooBar</span> <span class="o">=</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">lensFoo</span><span class="p">,</span> <span class="nx">lensBar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">view</span><span class="p">(</span><span class="nx">lensFooBar</span><span class="p">,</span> <span class="nx">sample</span><span class="p">)</span> <span class="c1">// =&gt; {ha: 6}
</span></span></span></code></pre></div><p>We can write a helper function to help us to get the inner lens:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lensPath</span> <span class="o">=</span> <span class="nx">path</span> <span class="p">=&gt;</span> <span class="nx">compose</span><span class="p">(...</span><span class="nx">path</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">lensProp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lensHa</span> <span class="o">=</span> <span class="nx">lensPath</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;ha&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">add</span> <span class="o">=</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">b</span> <span class="p">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">view</span><span class="p">(</span><span class="nx">lensHa</span><span class="p">,</span> <span class="nx">sample</span><span class="p">)</span> <span class="c1">// =&gt; 6
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">over</span><span class="p">(</span><span class="nx">lensHa</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nx">sample</span><span class="p">)</span> <span class="c1">// =&gt; {foo: {bar: {ha: 8}}}
</span></span></span></code></pre></div><p>Ok, I know you must be thinking: howâ€™s this powerful? I can achieve the same
thing using lodash <code>_.get()</code>! Stay patient!</p>
<p>Letâ€™s consider another example. Say we have an app that lets users log their
body weight. Users can fill in with both killograms and pounds. To avoid data
redundancy, we only stores user records in killograms. Here&rsquo;s a user record:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{</span><span class="nx">weightInKg</span><span class="o">:</span> <span class="mi">65</span><span class="p">}</span>
</span></span></code></pre></div><p>We know that we have the following conversion rate between kg and lb:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">kgToLb</span> <span class="o">=</span> <span class="nx">kg</span> <span class="p">=&gt;</span> <span class="mf">2.20462262</span> <span class="o">*</span> <span class="nx">kg</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lbToKg</span> <span class="o">=</span> <span class="nx">lb</span> <span class="p">=&gt;</span> <span class="mf">0.45359237</span> <span class="o">*</span> <span class="nx">lb</span>
</span></span></code></pre></div><p>If we want to display the user&rsquo;s weight in pounds, we can get the weight in kg,
and convert it to lb, which is a very straightforward approach. But we can do it
more smoothly with lenses:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">weightInKg</span> <span class="o">=</span> <span class="nx">lensProp</span><span class="p">(</span><span class="s1">&#39;weightInKg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">lensLb</span> <span class="o">=</span> <span class="nx">lens</span><span class="p">(</span><span class="nx">kgToLb</span><span class="p">,</span> <span class="nx">lbToKg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">inLb</span> <span class="o">=</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">lensLb</span><span class="p">,</span> <span class="nx">weightInKg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">view</span><span class="p">(</span><span class="nx">inLb</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="c1">// -&gt; 143.3
</span></span></span></code></pre></div><p>This looks neat. We provide different lenses to the <code>view</code> function, it will
return us a tailored result, and the target data remains untouched.</p>
<p>Suppose that the user one day adds 5 pounds to his record, the data can be
updated easily like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">over</span><span class="p">(</span><span class="nx">inLb</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nx">user</span><span class="p">)</span> <span class="c1">// -&gt; 67.27
</span></span></span></code></pre></div><p>Wow! That reads like plain English. Without digging into the implementation
details, we can interpret the operation as this: under this lens, I want to add
5 to the user record. I don&rsquo;t care in what unit the stored data may be, just do
it for me! The power of declarative programming really shines in this example.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://leihuang.me/tags/fp/">Fp</a></li>
      <li><a href="https://leihuang.me/tags/lens/">Lens</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://leihuang.me/posts/implementing-tri/">
    <span class="title">Â« Prev</span>
    <br>
    <span>Implementing A Trie In JavaScript</span>
  </a>
  <a class="next" href="https://leihuang.me/posts/curve-animation-in-js/">
    <span class="title">Next Â»</span>
    <br>
    <span>Parabolic Curve Animation With RxJS</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Introduction to Lenses in JavaScript on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fleihuang.me%2fposts%2flens-in-js%2f&amp;title=Introduction%20to%20Lenses%20in%20JavaScript&amp;summary=Introduction%20to%20Lenses%20in%20JavaScript&amp;source=https%3a%2f%2fleihuang.me%2fposts%2flens-in-js%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Introduction to Lenses in JavaScript on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fleihuang.me%2fposts%2flens-in-js%2f&title=Introduction%20to%20Lenses%20in%20JavaScript">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Introduction to Lenses in JavaScript on whatsapp"
            href="https://api.whatsapp.com/send?text=Introduction%20to%20Lenses%20in%20JavaScript%20-%20https%3a%2f%2fleihuang.me%2fposts%2flens-in-js%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>Â© 2025 Lei Huang</span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
