<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Non-Blocking | Lei's Blog</title>
<meta name=keywords content><meta name=description content="Personal Blog of Lei Huang"><meta name=author content="Lei Huang"><link rel=canonical href=https://leihuang.me/tags/non-blocking/><link crossorigin=anonymous href=/assets/css/stylesheet.4577291afec6711dad0a04c542b24213552d8652dd4306b3ef708f31cd6c229c.css integrity="sha256-RXcpGv7GcR2tCgTFQrJCE1UthlLdQwaz73CPMc1sIpw=" rel="preload stylesheet" as=style><link rel=icon href=https://leihuang.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://leihuang.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://leihuang.me/favicon-32x32.png><link rel=apple-touch-icon href=https://leihuang.me/apple-icon.png><link rel=mask-icon href=https://leihuang.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://leihuang.me/tags/non-blocking/index.xml><link rel=alternate hreflang=en href=https://leihuang.me/tags/non-blocking/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://leihuang.me/tags/non-blocking/"><meta property="og:site_name" content="Lei's Blog"><meta property="og:title" content="Non-Blocking"><meta property="og:description" content="Personal Blog of Lei Huang"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Non-Blocking"><meta name=twitter:description content="Personal Blog of Lei Huang"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://leihuang.me/ accesskey=h title="Lei's Blog (Alt + H)">Lei's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://leihuang.me/archives title=Archive><span>Archive</span></a></li><li><a href=https://leihuang.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://leihuang.me/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><div id=canvas-container><button id=fullScreenBtn title="Toggle fullscreen">
<svg viewBox="0 0 24 24" width="24" height="24" id="enter-fullscreen-icon"><path fill="currentcolor" d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
<svg viewBox="0 0 24 24" width="24" height="24" id="exit-fullscreen-icon" class="hidden"><path fill="currentcolor" d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>
</button>
<canvas id=home-canvas></canvas></div><article class="first-entry home-info"><header class=entry-header><h1>Lei Huang</h1></header><div class=entry-content><ul><li>is a software engineer based in Berlin.</li><li>He enjoys solving hard problems through code.</li><li>He loves mountains, but circumstances have him currently wandering the flatlands of Brandenburg.</li><li>He speaks English, Chinese, und ein bisschen Deutsch.</li></ul></div><footer class=entry-footer><div class=social-icons><a href=https://github.com/leihuang23 target=_blank rel="noopener noreferrer me" title="I Don't Usually Write Code After Work"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://bsky.app/profile/leihuang.me target=_blank rel="noopener noreferrer me" title="Find Me on Bluesky"><svg viewBox="-25 0 400 320" fill="none" stroke="currentcolor" stroke-width="30"><path d="M180 141.964c-16.301-31.702-60.692-90.7823-101.9653-119.92C38.4971-5.86834 23.414-1.03207 13.526 3.43594 2.08093 8.60755.0 26.1785.0 36.5164.0 46.8542 5.66748 121.272 9.36416 133.694 21.5786 174.738 65.0603 188.607 105.104 184.156 107.151 183.852 109.227 183.572 111.329 183.312 109.267 183.642 107.19 183.924 105.104 184.156 46.4204 192.847-5.69621 214.233 62.6582 290.33 137.848 368.18 165.705 273.637 180 225.702c14.295 47.935 30.76 139.069 115.995 64.628C360 225.702 313.58 192.85 254.896 184.158 252.81 183.926 250.733 183.645 248.671 183.315 250.773 183.574 252.849 183.855 254.896 184.158 294.94 188.61 338.421 174.74 350.636 133.697 354.333 121.275 360 46.8568 360 36.519 360 26.1811 357.919 8.61012 346.474 3.43851 336.586-1.02949 321.503-5.86576 281.965 22.0466 240.692 51.1843 196.301 110.262 180 141.964z"/></svg>
</a><a href=https://www.strava.com/athletes/109784228 target=_blank rel="noopener noreferrer me" title="Find Me on Strava"><svg viewBox="0 0 24 24" fill="currentcolor" stroke-width="2"><path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599 2.836 5.598h4.172L10.463.0l-7 13.828h4.169"/></svg>
</svg>
</a><a href=https://notes.leihuang.me target=_blank rel="noopener noreferrer me" title="My Notes"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>AI Has No Understanding</h2></header><div class=entry-content><p>The proliferation of AI (specifically LLMs) has been the major development in our industry recently. Many people are understandably impressed by the capabilities of cutting-edge LLMs. However, the hype sometimes becomes ridiculous. On Twitter, I’ve seen people claiming AGI is already here because some LLMs are capable of solving very advanced coding challenges.
I’ve been using LLMs at work for quite a while. Although it’s not rare for me to use them to generate code beyond my expertise, I remain convinced that current LLMs lack genuine cognitive capabilities. The notion of fully delegating human tasks to AI systems remains unrealistic today. I doubt whether it will ever be truly possible.
...</p></div><footer class=entry-footer><span title='2025-04-18 00:00:00 +0000 UTC'>April 18, 2025</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to AI Has No Understanding" href=https://leihuang.me/posts/ai-has-no-understanding/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Learn Batching From LLM</h2></header><div class=entry-content><p>I was reviewing my old notebook and came across a piece of code that I took from somewhere many years ago. I asked Claude 3.7 Sonnet about this code, and here’s the conversation:
Lei: Take a look at the following code:
let timeout = null; const queue = new Set(); function process() { for (const task of queue) { task(); } queue.clear(); timeout = null; } function enqueue(task) { if (timeout === null) timeout = setTimeout(process, 0); queue.add(task); } I’m not sure how is this code useful. One scenario I can think of is modifying the DOM. Doing DOM manipulation in one batch might avoid reflow. But I’m fuzzy on details. Can you give me a concrete example?
...</p></div><footer class=entry-footer><span title='2025-03-30 15:11:05 +0200 CEST'>March 30, 2025</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to Learn Batching From LLM" href=https://leihuang.me/posts/learn-batching-from-llm/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Category Mapping with Embedding</h2></header><div class=entry-content><p>Recently, I faced a daunting task: migrating all of our existing product deals to a brand new, more comprehensive, and standardized set of canonical product categories. This was critical for improving product discoverability, ensuring consistent marketing, and enabling better reporting. Think of it as moving from a somewhat disorganized, ad-hoc filing system to a meticulously organized, hierarchical library catalog.
The problem? Our system had tens of thousands of deals, each with existing category assignments that were often inconsistent, incomplete, or simply didn’t map cleanly to the new structure. Manually re-categorizing everything was out of the question. It would have taken an absurd amount of time and been incredibly prone to errors. I needed an automated solution, but a simple keyword-based approach wouldn’t work. The nuances of product descriptions and the potential mismatches between the old and new categories demanded something far more intelligent.
...</p></div><footer class=entry-footer><span title='2023-07-01 00:00:00 +0000 UTC'>July 1, 2023</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to Category Mapping with Embedding" href=https://leihuang.me/posts/category-mapping-with-embedding/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Time-slicing With Coroutine</h2></header><div class=entry-content><p>I wrote about time-slicing with CPS technique in the last blog post. The solution I proposed has two drawbacks:
The control over task scheduling is too weak. Task slicing relies entirely on hacking the JavaScript engine’s event loop, and it’s impossible to arbitrarily pause and resume. This makes it impossible to precisely time the slices; you can only set them based on subjective experience (the example I provided uses 500 as the interval). However, 500 tasks might still be too long, causing the main thread to be blocked for too long. Or it might be too short, not fully utilizing the current call stack. setTimeout’s timing is inaccurate, and the actual time interval will have deviations. The result is that the delays of each task accumulate, significantly increasing the total task completion time. An alternative solution: Coroutine If a computational task can suspend itself and yield execution to other tasks, it’s a coroutine.
...</p></div><footer class=entry-footer><span title='2020-08-15 00:00:00 +0000 UTC'>August 15, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to Time-slicing With Coroutine" href=https://leihuang.me/posts/time-slicing-with-coroutine/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Time-slicing With Continuation-passing Style</h2></header><div class=entry-content><p>Background story In January this year, I applied for an overseas dev job. I was asked to finish a project as homework. The project required a ton of computations on the front end, which posed a challenge as I must ensure no operations should block the main thread. I didn’t want to move the computation to a worker thread because the data was consumed in the main thread. Serializing and de-serializing a large set of data also has a performance cost. Furthermore, to improve indexing performance, I used Map to store the results, which is not serializable.
...</p></div><footer class=entry-footer><span title='2020-08-06 00:00:00 +0000 UTC'>August 6, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to Time-slicing With Continuation-passing Style" href=https://leihuang.me/posts/time-slicing-with-cps/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Typewriter Effect With RxJS</h2></header><div class=entry-content><p>Background I recently rewrote my blog website from scratch in Gatsby. This time, I didn’t use a starter template, so I had to make a lot of design decisions. When I wrote the bio section on the home page, initially I put a long heading there as a one-sentence introduction. As I was gazing at the screen, I felt something was wrong. It was too wordy. But after I took out a few words, I was not satisfied with what was left.
...</p></div><footer class=entry-footer><span title='2020-03-30 00:00:00 +0000 UTC'>March 30, 2020</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to Typewriter Effect With RxJS" href=https://leihuang.me/posts/typewritter-in-rxjs/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Implementing A Trie In JavaScript</h2></header><div class=entry-content><p>Recently, I encountered a situation where I need to perform text searches in a large set of data. Normally, I would do it in a filter function, but that would be slow when the list is too long. There’s a data structure for this situation. Meet the Trie!
Trie (pronounced try) is a tree-like data structure that’s created for efficient text searches.
How does it work Trie takes all words and rearranges them in a tree hierarchy. For example, the list of words ['abet', 'abode', 'abort'] will be transformed into a structure like this:
...</p></div><footer class=entry-footer><span title='2020-01-04 00:00:00 +0000 UTC'>January 4, 2020</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to Implementing A Trie In JavaScript" href=https://leihuang.me/posts/implementing-tri/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Introduction to Lenses in JavaScript</h2></header><div class=entry-content><p>When I was reading Eric Elliott's article on Lenses , I was curious about how such beautiful magic can be fully implemented in JavaScript. It was a tough exploration. Many of the tutorials online are about Haskell, which cannot be easily translated to JavaScript. I read the source code of Ramda and finally grokked how it works.
...</p></div><footer class=entry-footer><span title='2019-01-17 00:00:00 +0000 UTC'>January 17, 2019</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to Introduction to Lenses in JavaScript" href=https://leihuang.me/posts/lens-in-js/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Parabolic Curve Animation With RxJS</h2></header><div class=entry-content><p>I came across this article (written in Chinese) the other day. It was about parabolic curve animation in vanilla JS. I wondered how RxJS can implement this. Below is the result of my investigation.
Imagine we take a perspective from a slow-motion camera. What humans see as a smooth animation is just an object that is put at different places at every fragment of a time period. This can be expressed as a ‘stream’ of object position. The mechanism of an animation can be simplified by somehow mapping every fragment of a time period to a position point in space. In practice, time cannot be fragmented indefinitely, what we want is an approximation of an “atomic time unit”. The browser has provided us a tool to achieve this, which is the requestAnimationFrame API.
...</p></div><footer class=entry-footer><span title='2018-08-02 00:00:00 +0000 UTC'>August 2, 2018</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Lei Huang</footer><a class=entry-link aria-label="post link to Parabolic Curve Animation With RxJS" href=https://leihuang.me/posts/curve-animation-in-js/></a></article><script type=module src=/js/home-animation.js></script></main><footer class=footer><span>© 2025 Lei Huang</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>